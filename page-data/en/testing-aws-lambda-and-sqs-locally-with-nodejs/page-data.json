{"componentChunkName":"component---src-views-templates-blog-post-js","path":"/en/testing-aws-lambda-and-sqs-locally-with-nodejs/","webpackCompilationHash":"0cabe5040f67b0dbb647","result":{"data":{"site":{"siteMetadata":{"title":"Shahidul Islam Majumder","author":"Shahidul Islam Majumder","siteUrl":"https://shahid.pro"}},"markdownRemark":{"id":"ad34ff1d-0890-540b-85d0-2d9b19126a66","excerpt":"I suppose both of your Lambda function and SQS messages are ready, and AWS Lambda and SQS in  are up and running. We need the SQS queue URL and you can find all…","html":"<p>I suppose both of your Lambda function and SQS messages are ready, and AWS Lambda and SQS in <code class=\"language-text\">localstack</code> are up and running. We need the SQS queue URL and you can find all of the URLs by running this command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws --endpoint-url<span class=\"token operator\">=</span>http://localhost:4576 sqs list-queues</code></pre></div>\n<p>If you haven’t create any SQS queue yet, create one using the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws --endpoint-url<span class=\"token operator\">=</span>http://localhost:4576 sqs create-queue --queue-name test-sqs</code></pre></div>\n<p>Now create a directory and open it in a terminal window. We need to initialize this directory by running <code class=\"language-text\">npm init -y</code>. We need two npm packages to test our SQS and Lambda function locally: <code class=\"language-text\">lambda-local</code> and <code class=\"language-text\">sqs-consumer</code>. Install these packages by running the following command:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> i -S lambda-local sqs-consumer</code></pre></div>\n<p>Create a file named <code class=\"language-text\">index.js</code> and paste the following code in it. You have to change the configuration according to your settings.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> lambdaLocal <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'lambda-local'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> Consumer <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sqs-consumer'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> Consumer<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  queueUrl<span class=\"token punctuation\">:</span> <span class=\"token string\">'http://localhost:4576/queue/test-sqs'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">handleMessage</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">message</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> body <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>message<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> jsonPayload <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      Records<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n          body<span class=\"token punctuation\">:</span> message<span class=\"token punctuation\">.</span>Body<span class=\"token punctuation\">,</span>\n          messageAttributes<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            messageType<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n              stringValue<span class=\"token punctuation\">:</span> message<span class=\"token punctuation\">.</span>MessageAttributes<span class=\"token punctuation\">.</span>messageType<span class=\"token punctuation\">.</span>StringValue<span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    lambdaLocal\n      <span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        event<span class=\"token punctuation\">:</span> jsonPayload<span class=\"token punctuation\">,</span>\n        lambdaPath<span class=\"token punctuation\">:</span> <span class=\"token string\">'./my-lambda-function/index.js'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//your lambda function path</span>\n        timeoutMs<span class=\"token punctuation\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\n        envfile<span class=\"token punctuation\">:</span> <span class=\"token string\">'./my-lambda-function/.env'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//your lambda function env</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  messageAttributeNames<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'All'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'error'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'processing_error'</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Finally, add a <code class=\"language-text\">start</code> script in your <code class=\"language-text\">package.json</code> and run <code class=\"language-text\">npm start</code> to start the SQS consumer. If you trigger your SQS send message call now, you will see that your lambda function has been executed. You can check a complete setup in <a href=\"https://github.com/sh4hids/test-sqs-and-lambda-locally\">this git repo</a>.</p>\n<p>Please let me know if you faced any problem or not. Thanks for reading this short tutorial.</p>","frontmatter":{"title":"Testing AWS Lambda and SQS locally with Node.js","date":"November 15, 2019","language":"en"},"fields":{"slug":"/testing-aws-lambda-and-sqs-locally-with-nodejs/","readingTime":{"text":"2 min read"}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/testing-aws-lambda-and-sqs-locally-with-nodejs/","previous":{"fields":{"slug":"/add-disqus-on-gatsby-site-in-3-steps/"},"frontmatter":{"title":"Add Disqus Commenting on Gatsby Site in 3 Steps","language":"en","published":true}},"next":null,"intl":{"language":"en","languages":["en","bn"],"messages":{"title":"","baseUrl":"/en","mainMenu.home":"Home","mainMenu.about":"About","mainMenu.blog":"Blog","mainMenu.projects":"Projects","sectionTitle.projects":"Open Source Projects","sectionTitle.recentPost":"Recent Posts","sectionTitle.noPostYet":"No post yet...","about.title":"Hi, I'm Shahid..."},"routed":true,"originalPath":"/testing-aws-lambda-and-sqs-locally-with-nodejs/","redirect":true,"allSitePage":["/offline-plugin-app-shell-fallback/","/en/offline-plugin-app-shell-fallback/","/bn/offline-plugin-app-shell-fallback/","/testing-aws-lambda-and-sqs-locally-with-nodejs/","/en/testing-aws-lambda-and-sqs-locally-with-nodejs/","/bn/testing-aws-lambda-and-sqs-locally-with-nodejs/","/add-disqus-on-gatsby-site-in-3-steps/","/en/add-disqus-on-gatsby-site-in-3-steps/","/bn/add-disqus-on-gatsby-site-in-3-steps/","/javascript-object-key-existence-check/","/en/javascript-object-key-existence-check/","/bn/javascript-object-key-existence-check/","/404/","/en/404/","/bn/404/","/about/","/en/about/","/bn/about/","/blog/","/en/blog/","/bn/blog/","/","/en/","/bn/","/projects/","/en/projects/","/bn/projects/","/404.html","/en/404.html","/bn/404.html"]},"language":"en"}}}